<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Juicio Secreto</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- AUDIO -->
  <audio id="bgm" preload="auto" loop>
    <source src="./assets/music.m4a" type="audio/mp4" />
    <source src="./audio/bgm.mp3" type="audio/mpeg" />
  </audio>

  <!-- Gate si autoplay bloqueado -->
  <div id="audioGate" class="audioGate hidden">
    <div class="audioGateCard">
      <div class="audioGateTitle">Audio bloqueado</div>
      <div class="audioGateText">
        Tu navegador bloqueÃ³ el autoplay. Toca el botÃ³n para arrancar la mÃºsica.
      </div>
      <button id="audioGateBtn" class="bigBtn" type="button">â–¶ Activar mÃºsica</button>
      <div class="miniNote">DespuÃ©s usa ğŸ”Š/ğŸ”‡ arriba (solo mute).</div>
    </div>
  </div>

  <div class="cabinet">
    <div class="topBar">
      <div class="marquee">
        <span>âš–ï¸ Juicio Secreto Â· Ronda 1 (Privada) Â· Ronda 2 (PÃºblica) Â· âš–ï¸</span>
        <span>âš–ï¸ Juicio Secreto Â· Ronda 1 (Privada) Â· Ronda 2 (PÃºblica) Â· âš–ï¸</span>
      </div>

      <div class="topControls">
        <div class="titleBlock">
          <div class="logo">âš–ï¸</div>
          <div>
            <h1>Juicio Secreto</h1>
            <div class="sub">Aleatorio sin repetir juzgados. Luego se adivina.</div>
          </div>
        </div>

        <div class="audioBox">
          <!-- <div id="statusPill" class="statusPill">Cargando JSâ€¦</div> -->

          <!-- âœ… Nuevo: botÃ³n instrucciones -->
          <button id="helpBtn" class="iconBtn" type="button" title="Instrucciones">
            <span>ğŸ“œ</span>
          </button>

          <button id="muteBtn" class="iconBtn" type="button" title="Mute">
            <span id="muteIcon">ğŸ”Š</span>
          </button>
        </div>
      </div>
    </div>

    <div class="shell">
      <!-- Sidebar sigue existiendo pero en mÃ³vil la hago compacta con CSS -->
      <aside class="side">
        <div class="panel panelA">
          <h2>Jugadores</h2>
          <div id="playersChips" class="chips"></div>

          <div class="sideBtns">
            <button id="openPlayersBtn" class="btn btnBlue" type="button">ğŸ‘¥ Editar jugadores</button>
            <button id="startRound1Btn" class="btn btnGreen" type="button">â–¶ Iniciar Ronda 1</button>
            <button id="toRound2Btn" class="btn btnPurple" type="button">ğŸ‘€ Ir a Ronda 2</button>
            <button id="wipeBtn" class="btn btnRed" type="button">ğŸ§½ Borrar datos</button>
            <!-- <button id="resetAllBtn" class="btn btnOrange" type="button">ğŸ”¥ Reiniciar partida</button> -->
          </div>

          <!-- <div class="miniNote">
            El status arriba debe decir â€œJS OK âœ…â€.
          </div> -->
        </div>

        <div class="panel panelB">
          <h2>Progreso</h2>
          <div class="meter"><div id="progressBar"></div></div>
          <div id="meterLabel" class="meterLabel">0/0</div>
        </div>
      </aside>

      <main class="stage">
        <!-- SETUP (se queda, pero ahora el input real vive en un lightbox) -->
        <section id="screenSetup" class="screen">
          <div class="screenHeader">
            <div class="screenSticker">ğŸ§©</div>
            <div>
              <h2>Inicio</h2>
              <p>Primero agrega jugadores en el panel flotante.</p>
            </div>
          </div>

          <div class="startHint">
            Toca â€œğŸ‘¥ Editar jugadoresâ€. Cuando tengas mÃ­nimo 2, inicia Ronda 1.
          </div>
        </section>

        <!-- ROUND 1: CONFIRM -->
        <section id="screenTurn" class="screen hidden">
          <div class="screenHeader">
            <div class="screenSticker">ğŸ­</div>
            <div>
              <h2>Ronda 1</h2>
              <p>Solo el jugador actual debe ver la pantalla.</p>
            </div>
          </div>

          <div class="gameTop">
            <div class="who">
              <div class="whoBadge" id="judgeBadge">Juez: â€”</div>
              <div class="counter" id="turnCounter">0/0</div>
            </div>
            <div class="counter" id="phasePill">Fase: ConfirmaciÃ³n</div>
          </div>

          <div class="questionCard">
            <div class="questionTitle">Paso 1</div>
            <div class="q" id="turnText">Toca OK para revelar a quiÃ©n juzgas.</div>
          </div>

          <div class="controls">
            <button id="turnOkBtn" class="btn btnBlue" type="button">OK âœ…</button>
          </div>
        </section>

        <!-- ROUND 1: QUESTIONS -->
        <section id="screenQuestions" class="screen hidden">
          <div class="screenHeader">
            <div class="screenSticker">ğŸ“</div>
            <div>
              <h2>Responde por la persona juzgada</h2>
              <p id="targetLabel">Objetivo: â€”</p>
            </div>
          </div>

          <div class="gameTop">
            <div class="who">
              <div class="whoBadge" id="judgeBadge2">Juez: â€”</div>
              <div class="counter" id="qCounter">1/6</div>
            </div>
          </div>

          <div class="questionCard">
            <div class="questionTitle" id="qTitle">Pregunta 1</div>
            <div class="q" id="qText">â€”</div>
          </div>

          <div id="answers" class="answers"></div>

          <div class="controls">
            <button id="prevBtn" class="btn btnYellow" type="button">â¬… AtrÃ¡s</button>
            <button id="nextBtn" class="btn btnGreen" type="button">Siguiente â¡</button>
          </div>
        </section>

        <!-- ROUND 1: DONE -->
        <section id="screenRound1Done" class="screen hidden">
          <div class="screenHeader">
            <div class="screenSticker">âœ…</div>
            <div>
              <h2>Turno guardado</h2>
              <p>Pasa el celular al siguiente jugador.</p>
            </div>
          </div>

          <div class="resultHeader">
            <div class="medal">ğŸ“¦</div>
            <div>
              <div class="resultText" id="doneText">â€”</div>
              <div class="tags" id="doneTags"></div>
            </div>
          </div>

          <div class="controls">
            <button id="nextTurnBtn" class="btn btnBlue" type="button">Siguiente turno â–¶</button>
            <button id="finishRound1Btn" class="btn btnPurple" type="button">Terminar Ronda 1</button>
          </div>
        </section>

        <!-- ROUND 2 -->
        <section id="screenRound2" class="screen hidden">
          <div class="screenHeader">
            <div class="screenSticker">ğŸ‘€</div>
            <div>
              <h2>Ronda 2</h2>
              <p>Se muestra un caso. Voten tocando un nombre.</p>
            </div>
          </div>

          <div class="gameTop">
            <div class="who">
              <div class="whoBadge" id="caseCounterBadge">Caso 1/1</div>
            </div>
            <div class="controls" style="margin:0">
              <button id="nextCaseBtn" class="btn btnOrange" type="button">Siguiente caso â–¶</button>
              <button id="restartRound2Btn" class="btn btnYellow" type="button">Reiniciar Ronda 2</button>
            </div>
          </div>

          <ul id="caseAnswers" class="review"></ul>

          <div class="details">
            <div><b>Vota quiÃ©n era el juzgado:</b></div>
            <div class="chips" id="voteChips"></div>
            <div class="miniNote" id="voteResult">Toca un nombre para votar.</div>
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- âœ… Modal instrucciones -->
  <div id="helpModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="helpTitle">
    <div class="modalCard">
      <div class="modalCloseRow">
        <div class="modalTitle" id="helpTitle">ğŸ“œ Instrucciones</div>
        <button id="helpCloseBtn" class="xBtn" type="button" aria-label="Cerrar">âœ•</button>
      </div>

      <div class="modalBody">
        <div class="modalMsg">
          <div class="rulesBlock">
            <div class="rbTitle">Ronda 1 (Privada)</div>
            <ul class="rbList">
              <li>Se pasan el celular por turnos.</li>
              <li>El juez toca <b>OK</b> y se le revela a quiÃ©n juzga.</li>
              <li>Responde <b>6 preguntas</b> como si fuera esa persona.</li>
              <li>No se repiten juzgados: cada jugador es objetivo una vez.</li>
            </ul>
          </div>

          <div class="rulesBlock">
            <div class="rbTitle">Ronda 2 (PÃºblica)</div>
            <ul class="rbList">
              <li>Todos pueden ver el celular.</li>
              <li>Sale un caso al azar (preguntas + respuestas).</li>
              <li>Todos votan tocando un nombre.</li>
              <li>Sale un lightbox: espera 3s y revela si acertaron.</li>
            </ul>
          </div>

          <div class="rulesBlock">
            <div class="rbTitle">Controles</div>
            <ul class="rbList">
              <li>ğŸ”Š/ğŸ”‡ mute</li>
              <li>ğŸ”¥ reinicia todo</li>
              <li>ğŸ‘¥ editar jugadores</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… Modal jugadores (lightbox) -->
  <div id="playersModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="playersTitle">
    <div class="modalCard">
      <div class="modalCloseRow">
        <div class="modalTitle" id="playersTitle">ğŸ‘¥ Jugadores</div>
        <button id="playersCloseBtn" class="xBtn" type="button" aria-label="Cerrar">âœ•</button>
      </div>

      <div class="modalBody">
        <div class="playersRow">
          <input id="nameInput" class="input" placeholder="Nombre del jugador" autocomplete="off" />
          <button id="addPlayerBtn" class="bigBtn" type="button">+ Agregar</button>
        </div>

        <div class="miniNote" id="playersHint">
          Agrega mÃ­nimo 2. Puedes borrar con âœ•.
        </div>

        <div id="playersList" class="playersList"></div>

        <div class="controls">
          <button id="playersDoneBtn" class="btn btnGreen" type="button">Listo âœ…</button>
        </div>
      </div>
    </div>
  </div>

  <!-- âœ… Modal resultado (ya existÃ­a) -->
  <div id="resultModal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modalCard">
      <div class="modalTop">
        <div class="modalSticker">ğŸ</div>
        <div>
          <div id="modalTitle" class="modalTitle">Revelandoâ€¦</div>
          <div id="modalSub" class="modalSub">Espera 3 segundos.</div>
        </div>
      </div>

      <div class="modalArtWrap">
        <img id="modalImg" class="modalImg" alt="Entrada" />
      </div>

      <div id="modalBody" class="modalBody">
        <div id="modalMsg" class="modalMsg">â€¦</div>
      </div>

      <div class="controls">
        <button id="modalNextBtn" class="btn btnGreen hidden" type="button">Siguiente caso â–¶</button>
      </div>
    </div>
  </div>

  <script src="./constants.js?v=5" defer></script>
  <script src="./app.js?v=5" defer></script>
</body>
</html>
